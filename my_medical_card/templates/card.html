<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartão Médico Virtual</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .card-container {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            background-color: #f9f9f9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 800px; /* Definindo um tamanho máximo para o cartão */
            display: inline-block; /* Exibir em linha para capturar ambos os lados */
            position: relative; /* Para permitir o posicionamento da imagem */
        }

        .card-title, .verso-title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .info, .details {
            font-size: 16px;
            line-height: 1.5;
        }

        #download-btn {
            text-align: center;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .logo {
            position: absolute;
            top: 15px; /* Ajuste a posição vertical */
            right: 15px; /* Ajuste a posição horizontal */
            width: 40px; /* Ajuste o tamanho conforme necessário */
            height: auto; /* Mantém a proporção da imagem */
        }
        .qr-code {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 25%; /* Ajuste este valor conforme necessário */
            height: auto;
        }
        
        .qr-code img {
            max-width: 100%; /* Garante que a imagem não ultrapasse o contêiner */
            height: auto;
        }
    </style>
</head>
<body>
    <div id="card" style="display: flex; flex-direction: column; align-items: center;"> <!-- Contêiner para o cartão -->
        <!-- Frente do Cartão -->
        <div class="card-container" id="card-front">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo"> <!-- Imagem no canto superior direito -->
            <div class="card-title">Cartão Médico Virtual</div>
            <div class="name">{{ name }}</div>
            <br>
            <div class="info">
                <div><strong>Tipagem Sanguínea:</strong> {{ blood_type }}</div>
                <div><strong>Data de Nascimento:</strong> {{ birth_date }}</div>
            </div>
            <div class="details">
                <br>
                <p><strong>RG:</strong> {{ rg }}</p>
                <p><strong>CPF:</strong> {{ cpf }}</p>
                <p><strong>Número do Cartão SUS:</strong> {{ sus_number }}</p>
                <p><strong>CID:</strong> {{ cid }}</p>
            </div>
        </div>

        <!-- Verso do Cartão -->
        <div class="card-container" id="card-back">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="logo">
            <div class="verso-title">Cartão Médico Virtual</div>
            <div class="DM">Dados Médicos</div>
            <div class="info"></div>
            <div class="details">
                <br>
                <p><strong>Remédio Controlado:</strong> {{ medication }}</p>
                <p><strong>Histórico de Cirurgias:</strong> {{ surgery }}</p>
                <p><strong>Doenças na Família:</strong> {{ family_diseases }}</p>
                <p><strong>Alergias:</strong> {{ allergies }}</p>
                <p><strong>Doença Crônica:</strong> {{ chronic_disease }}</p>
            <!-- Exibir o QR Code -->
            <div class="qr-code">
                <img src="{{ url_for('generate_qrcode') }}" alt="QR Code" class="img-fluid">
            </div>
        </div>
    </div>

    <!-- Botão para download -->
    <div id="download-btn">
        <button class="btn btn-primary btn-download" onclick="downloadCard()">Download</button>
    </div>

    <!-- Inclusão da biblioteca html2canvas -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js"></script>
    <script>
        function downloadCard() {
            document.querySelector('.btn-download').classList.add('hide-download');
            html2canvas(document.querySelector("#card"), { // Captura o contêiner do cartão
                scale: 2,  // Aumenta a escala do canvas para melhorar a qualidade
                useCORS: true, // Habilita CORS para carregar imagens de domínios externos
                backgroundColor: null // Para manter o fundo transparente se necessário
            }).then(canvas => {
                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/png', 1.0); // Qualidade máxima
                a.download = 'cartao-medico.png';
                a.click();
                document.querySelector('.btn-download').classList.remove('hide-download');
            });
        }
    </script>

    <!-- Script para adicionar arrastar o cartão -->
    <script>
    </script>
</body>
</html>
