<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartão Médico Virtual</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .card-container {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px;
            background-color: #f9f9f9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 800px; /* Definindo um tamanho máximo para o cartão */
            display: inline-block; /* Exibir em linha para capturar ambos os lados */
        }

        .card-title, .verso-title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
        }

        .info, .details {
            font-size: 16px;
            line-height: 1.5;
        }

        #download-btn {
            text-align: center;
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="card" style="display: flex; flex-direction: column; align-items: center;"> <!-- Contêiner para o cartão -->
        <!-- Frente do Cartão -->
        <div class="card-container" id="card-front">
            <div class="card-title">Cartão Médico Virtual</div>
            <div class="name">{{ name }}</div>
            <br>
            <div class="info">
                <div><strong>Tipagem Sanguínea:</strong> {{ blood_type }}</div>
                <div><strong>Data de Nascimento:</strong> {{ birth_date }}</div>
            </div>
            <div class="details">
                <br>
                <p><strong>RG:</strong> {{ rg }}</p>
                <p><strong>CPF:</strong> {{ cpf }}</p>
                <p><strong>Número do Cartão SUS:</strong> {{ sus_number }}</p>
                <p><strong>CID:</strong> {{ cid }}</p>
            </div>
        </div>

        <!-- Verso do Cartão -->
        <div class="card-container" id="card-back">
            <div class="verso-title">Cartão Médico Virtual</div>
            <div class="DM">Dados Médicos</div>
            <div class="info"></div>
            <div class="details">
                <br>
                <p><strong>Remédio Controlado:</strong> {{ medication }}</p>
                <p><strong>Histórico de Cirurgias:</strong> {{ surgery }}</p>
                <p><strong>Doenças na Família:</strong> {{ family_diseases }}</p>
                <p><strong>Alergias:</strong> {{ allergies }}</p>
                <p><strong>Doença Crônica:</strong> {{ chronic_disease }}</p>
            </div>
        </div>
    </div>

    <!-- Botão para download -->
    <div id="download-btn">
        <button onclick="downloadCard()">Download</button>
    </div>

    <!-- Inclusão da biblioteca html2canvas -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js"></script>
    <script>
        function downloadCard() {
            html2canvas(document.querySelector("#card"), { // Captura o contêiner do cartão
                scale: 2,  // Aumenta a escala do canvas para melhorar a qualidade
                useCORS: true, // Habilita CORS para carregar imagens de domínios externos
                backgroundColor: null // Para manter o fundo transparente se necessário
            }).then(canvas => {
                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/png', 1.0); // Qualidade máxima
                a.download = 'cartao-medico.png';
                a.click();
            });
        }
    </script>

    <!-- Script para adicionar arrastar o cartão -->
    <script>
        let isDragging = false;
        let startX;
        let scrollLeft;

        const card = document.querySelector('.card-container');

        card.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.pageX - card.offsetLeft;
            scrollLeft = card.scrollLeft;
            card.style.cursor = "grabbing";
        });

        card.addEventListener('mouseleave', () => {
            isDragging = false;
            card.style.cursor = "grab";
        });

        card.addEventListener('mouseup', () => {
            isDragging = false;
            card.style.cursor = "grab";
        });

        card.addEventListener('mousemove', (e) => {
            if(!isDragging) return;
            e.preventDefault();
            const x = e.pageX - card.offsetLeft;
            const walk = (x - startX) * 2; // Velocidade de arrasto
            card.scrollLeft = scrollLeft - walk;
        });
    </script>
</body>
</html>
